generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["rhel-openssl-1.0.x", "rhel-openssl-3.0.x", "darwin-arm64"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Admin {
  adminId        Int    @id @default(autoincrement()) @map("admin_id")
  firstName      String @map("first_name") @db.VarChar(50)
  lastName       String @map("last_name") @db.VarChar(50)
  email          String @unique @map("email") @db.VarChar(100)
  hashedPassword String @map("hashed_password") @db.VarChar(255)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@index([email])
  @@map("admins")
}

model Service {
  serviceId   Int     @id @default(autoincrement()) @map("service_id")
  name        String  @unique @map("name") @db.VarChar(100)
  description String? @map("description") @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  reservations  Reservation[]
  OptionService OptionService[]

  @@map("services")
}

model Option {
  optionId    Int     @id @default(autoincrement()) @map("option_id")
  name        String  @default("") @map("name") @db.VarChar(100)
  printName   String  @default("") @map("print_name") @db.VarChar(100)
  description String? @map("description") @db.Text
  price       Int     @map("price")
  stock       Int?    @map("stock")
  limit       Int?    @map("limit")
  displayType String  @default("input") @map("display_type") @db.VarChar(20)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  optionReservations OptionReservation[]
  OptionService      OptionService[]

  @@map("options")
}

model OptionService {
  serviceId Int @map("service_id")
  optionId  Int @map("option_id")
  order     Int @map("order")

  option  Option  @relation(fields: [optionId], references: [optionId], onDelete: Cascade, onUpdate: Cascade)
  service Service @relation(fields: [serviceId], references: [serviceId], onDelete: Cascade, onUpdate: Cascade)

  @@id([serviceId, optionId])
  @@map("options_services")
}

enum ReservationStatus {
  PENDING   @map("PENDING")
  CONFIRMED @map("CONFIRMED")
  CANCELLED @map("CANCELLED")
  COMPLETED @map("COMPLETED")
}

model Reservation {
  reservationId Int               @id @default(autoincrement()) @map("reservation_id")
  serviceId     Int               @map("service_id")
  startDateTime DateTime          @map("start_date") @db.Timestamptz()
  endDateTime   DateTime          @map("end_date") @db.Timestamptz()
  firstName     String            @map("first_name") @db.VarChar(50)
  lastName      String            @map("last_name") @db.VarChar(50)
  email         String            @map("email") @db.VarChar(100)
  phoneNumber   String            @map("phone_number") @db.VarChar(20)
  adultCount    Int               @default(0) @map("adult_count")
  childCount    Int               @default(0) @map("child_count")
  otherInfo     String?           @map("other_info") @db.Text
  status        ReservationStatus @default(PENDING) @map("status")
  totalPrice    Int               @map("total_price")
  discount      Int               @default(0) @map("discount")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  service            Service                      @relation(fields: [serviceId], references: [serviceId], onDelete: Restrict, onUpdate: Cascade)
  optionReservations OptionReservation[]
  discoveryMethods   DiscoveryMethodReservation[]

  @@index([serviceId])
  @@index([startDateTime, endDateTime])
  @@map("reservations")
}

model OptionReservation {
  optionId      Int @map("option_id")
  reservationId Int @map("reservation_id")
  quantity      Int @map("quantity")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  reservation Reservation @relation(fields: [reservationId], references: [reservationId], onDelete: Cascade, onUpdate: Cascade)
  option      Option      @relation(fields: [optionId], references: [optionId], onDelete: Cascade, onUpdate: Cascade)

  @@id([reservationId, optionId])
  @@index([reservationId])
  @@index([optionId])
  @@map("options_reservations")
}

model DiscoveryMethod {
  name String @id @map("name") @db.VarChar(100)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  reservations DiscoveryMethodReservation[]

  @@map("discovery_methods")
}

model DiscoveryMethodReservation {
  reservationId       Int    @map("reservation_id")
  discoveryMethodName String @map("discovery_method_name")

  Reservation     Reservation?     @relation(fields: [reservationId], references: [reservationId], onDelete: Cascade, onUpdate: Cascade)
  DiscoveryMethod DiscoveryMethod? @relation(fields: [discoveryMethodName], references: [name], onDelete: Cascade, onUpdate: Cascade)

  @@id([reservationId, discoveryMethodName])
  @@map("discovery_methods_reservations")
}
